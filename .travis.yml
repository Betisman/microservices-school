sudo: true
language: node_js
env:
  global:
  # DOCKER_USERNAME
  - secure: zUZMzQxGq3gWO2hd80q2QEaaAKDCUtormDeyiQ+P+eUTYrYAES3oJG/bQXW4ljUBqquzOh6foxYf6AIKHcF4PI+H2y7h1B9vrkSX5WGRi7QQEBnHLTXv+LfhhXjpCv5gMUACJnf7lYoxXQDa+PQaDKQF/cXF2YxfVbTN+GoeDhOtU2K1qhJyoypW77vNBUWXI10YOQgeVAtsXSORJI2rX0h/DqH3M0ICO8bMeN+ln43lIrSDZlKQ+R6TFfSCJ4mWSzSlN2JiFh69NYfieu37LxE0fA0JssWzXGN3YopuFDgtfZ3xKb5ifugjKOKIpEJW/BQQRImqNtQIBYARU7mYRN7caK9JC1B/dqqDTV5FwtwNm9FBweT16qoKV1KtmTtLwsNdTsMvRyOR4yTR78Au4dRtfPA5sjSaZNmVU//vPj5AWEYnNrCgssfmWDUt1oDdISYQsBFC6RerYT4w1NeDVUmK19tFWZsFBxzaUG1RyAiy5FeVpBcj/s/Zm6Ott6/yg8WpcVxnOjQUImKFTGU91W5XWKqkoPNuCVq9rf6DEGUPkU7GRjbF3kqGLWlEB2VlkUmpCQIcB2H/BCniWjnYEd3r7MOJZ7NC+suwNZ6vbAD7XH44N3yVbcbHWfAKb/1F05EeA/G2XSe2JL5RSyS5Y5ItMH931yxN/Z7rsglBTFI=
  # DOCKER_PASSWORD
  - secure: 3e9JY7IuqvBP7+V62RjMET56wLxXxzLAdgyPqsFJ0wBUBv/emmQxvEk+c4s8E+SAEoCVvQAUenRVEJkeiIArsckAk2E4JtCIn9C8FFalpMImBxZCHTh9tlbzVUOJ9xCVxUtrd2wtjb7ftHv1ybXYHm7F5hjyZyyWXe9e+VHWyj7a7IlvZ4UjATAhAuqw38o8ORp+ygq/+IyWiFn7Xt2RfFnL60xUtwpLv0UvFvkrutYCLK/0FtsZsuSDRjTxQmh1VR0Z8WWZ+Xhon6JPmSwywbCnjVrEdPXlTt1kmNkiG0TBHc178i3Byvufby4XbIghD8CqLPU18q87i5DobALNYJoq0PhYD4pYcccLild6N+T/dMWQ+Gj7qj4GgQX35RYMYSo0UThmH+aXWIwNVSt1OofI7wNkhin1B4wAKLUzMqD20MTfXJSQlx51tabmLilVRIzKAUFq+kkzT7hEgi0i7mOIgXsLjtZt1yeytz76k365EKfarFvh9fZoRYkm1KoE6PWB/kIi/xtRyMBqvQgEC+pg7qVpiavfOM9tl85dkRrVoo+hRuEMq8GB+hxJvai5iV677wQC/d1/xBJJoj4XGvEXsXxUxnhx51jzFOvKkOiSXL2YBTxEGbnmCypzXKS7So3Abfgw9QkLrXflR9Y9RO1aCbJ5pJj4jz6AW97pDHk=
  # F2F_KEY (https://food2fork.com/about/api)
  - secure: igBw9zTVJlSwh+xr6pouJ46ee40h7gBeI4Lwdf4FFz6K74qOIy5YoOnrKdZu3oNe0eUSXSwVQAnb+lusvNBuGYJozVSq24R58XTtxROIxWhlwvWO/esx3VhrlmcmHogK442f/6CXpAOYpSsDnHU6FLzha9b+1dT+RTt1ppuIY7s5VRqW4OEbcnhoaFvsJxnVmnWm169vods+IuiUeLVmQ3r9FUQyIukNw4Da36gZBLODo83YThcRku/W1GqZkLmsG3r8tXsaMXWiCbIVgsLl9jQHKmyI+UOBTVl5ruTW6EbxQT4BvXTgHBJzyFJfE1tu7kQb07TD7V4mUAa13CGqcSABjv6jSPluju07tCXrfDtrwj4e14kCrlRxXErgJeGCT3k4rOrdHj3xaI9CNeGy7NgN8hsFx/6jXO+UQuR2mGo4EnMyai/1QHmrO2po4or4oP7qfJFNzt09OWsCfgnAEkh49QgbAjeEP56D5HFKl95Y7NoXuZywZiCQp2Pdl2VCoISlTGXUYyOcmkkpv8i1/CcliNtrdXFLN1ddjMLS1Wt16rdCvQS7nZAQNVuL5CvxorNZ9z1qaJ4oTd8aOwpAB/nw/KQ734HTpfDQYcGlFlkovvlUMnHdllK96LXRUzzbo5ZUkOEO1WajMzKEtved7Y0ZQ9azeUU7EmoBR9iGx1w=
  # AWS_ACCESS_KEY_ID
  - secure: d39mefQF/LzJWWz+gKAoXT4LqIQfY0I8e8giWGh5bq2aJxZi6lp/uwTRpH2sU3EcM2ShPUaoiUZYxMfC5VlSJz447oLO8yRRJ3VR1HsZlkqfpXyI3wHCBKbjofy7IqIIwnZtLwf/uN/pdU1w3KNoIyGEYH1lI7xzfZqUlEtVZUDhx+tA4O5nPjMwXkH9Ax2rrN31kCNPIDfixdm9VucJIjiedc+FneUjtiu56HaBmjBU1xVG4oL/mdYtXTHP/zaqI2CbFs0Yzs/7+TakfCeaCY0U+qHnsW3S0ieCIHGJruy+Ce7QpBX/GaBx+eX1itLWWmHAKVBwiUltT3yVtL8JiIJbLG/0rYL5FAgoOjFJpamBImZnONB3vSPh8IOUuaTGJaxtXztRYNxDQmoowUvrDJqFquKRsA6JRXffIFuIAH1++TuJdevSW2VISnv8c+JE8yvx3wxVhWbnXmLTElPPWMNJGplHbfCZDM62mjxT6tEIwp2YO3e9S9UMvJFNiaMX6TFlA/UUos86AX8R4PWP8HWzWPZjMmnZysIlQfTDzRrX8kxBjLJ7OiTPcR+8Z9P8aLiScZJ0qv4u8n18Xex9/RUummvWOF2GO6mEm6LQXVKTHy/o/em3l8UXIHYFiqcxtdo7OGTvI74bgtCqb6+W6I9AOwehGV2KCLmG8GuYaao=
  # AWS_SECRET_ACCESS_KEY
  - secure: YUspYRLzRT5wKwCNDqRI5Xv+plaS3MODRzEUUqDWYrhLGG/VvZAtcGaad8O0WGLxObTL8Do7ATKt7yAUClCScEHPkaGIPMcB/miVG0sm0jcS7r81odw3CIJzR6DMIXhYs8H6f4nsoZmH8xIRm0wYMu8tFN9MOkiUbo11FjxcpcExaBzCMzUZGMJh5TvHQ0w+daIRs4QFi6/EVLvuD6ioaBtXPM5UnrMot2cwwJMS2ObDUIxjPyjkzZYy+MMTs9SlZLyXBd3b+cKdBOFmfn6J+v0E9eAVCYVWMl302q0UrNQck+bzDFTSiPbFf/ck9rgcFbtoasAA48lzHtqQxN1Ooq3n0z6BafJCyN9QfFctpyx+FoieV50yE82SFSTqjFKBevLkxR+K1PMvd+/DFyiu0/mM/RbhovGRDoF/VJ26lvV4n27N4bibQxudQjJNz03XKr/7l4u+VUD6sGQKVYp8sFKv8fd/6i2er8Ywu9i8p0eUzum8JLhmqquOPrjHql0Dl4q7Q5AayiQBeo2tr0fI1z+B/CluGHmMVYUOMfFiRPP2lHn8PIraoFGSdY2K/rWFcb564r+RjHhcEKli+7yQFzHJFC2fe+WrOcrzjg/KB/AYNy7fq3ac+lUBzxNqrla5KRczPooy5I/Qnoy7KwofA0vhdScvAGRwFNTp/kpUBO0=
  # MONGO_URL
  - secure: liFJcESq+DhzQSnsCL8uA4pog9k4cawcr6HCsZUTCU7Zu0jnYno1344ADhaRayOAANoXBeSLxYxAIMosuS6YZ+f5umXuRu5do3rd4KA4syS+IOLO/Kmgyp0vFmlAZlBldLJ3sZFhMusSO3XljZxnyK+9cseiRd1z3kgH0kc5aLZfbzFtiXIvLPW3VutNuqGXvaJ8ayI+t02js0XbUyJDksbuqGlBD8IIlIQyvftneUXjt9shMrfEgDmJ++8h4/cPXiYKdMpI5dkcRkakclJUAra9sgZ4tMwfVuJTE2se2/2+1y5tFhgOHy9z/FILIq87ZOVCVibltT7v59t1jQ5R+o06/8dW0VnSmVuUIl7ybgBlw363pJIamjZbALT5nbEGN7vC9KnECAwmLu6AQHODvWbNRKsgTufigwR0AEzMxSBkYyuDLOwhtBuiStrBb3dKO7CGqbN4CixjwJTGsf0u6gCDa1TCnz1rpv0/oM8dd+AJVSr6kvWnGbHBmw/WrSeiSmzfr4KhnchDFd2IXspiBfrvlO4iGxRI5k2tnkV49Pcp/Y/sy+EXxn0+B0xhK4wJ9YTn2/a2+mSukvlcXUU3Ij460k3MLA/EuRBs3U3ILpR7CPMTAVzx7l39J9PmvuOabDmHsyIAv7mVv1T7UQ73JwjCH9YKZkk4j+fbMJH+CWU=
  # RABBIT_PWD
  - secure: jbfk03+Y6I0c5p+LpohTjW/J5eulfl4FyVUFlefLQX6dJMFjx/+mQZaew5nYAxM4lz9YSpNTDkLq3FO1KvupjGOh4vJ7phoEGH+CDRM6gi+WtS+Pq6aBjnIlMKM3FZWBWUD1Hn206mLkk8xecCzN4ehGEgLyKOW6IKCiAXDwLbYnUKKEuWFFBLNiqcqWvh0rJsRngNAFh5dTLjWwTIxkDawV9hU9938z+r5sipox7vNsSY1ZfUVyQ+fGUQpyi6jzeIa/51JHTYxFnv+ujIXI+rJLBZeoj1mXdjcsHdjZTCFldRIa3Tn8/YcpaD+8TJbZdqEtf5SHBb7UvjPSaWc7rODQokXxdaTeiouAr3oibC+SAofMdGgcR2gS4XgS7zbJbboVMLcTWOLZeSYmSX7IuH9OwniVXARfkifdt4/BZt2VrWkmCNtFLJstX/x2BKZlqKl4vagtS6j7rYRet4zPrGJ8ytbirjV8WlpIUXO//w8UXXK1CKBdrIP+MpU21Hjra2lOtltJD6dgoOgpeZegeq+XQcwn+0S4d8WZ5nUgS3QT66Ui5IFYQayC23MxaKF4bB08CZm4OtYaEahxGNlclswi1mE5V/BKJL5LEdvApux8wYCm8IE1b3baAdN51bVpuiWKc7DHVSZ+i3dY1Wwrwfxovzr1A2HWyVYnyFOY02U=
  # SUMO_URL
  - secure: cQzIeQhgd4rPJbrSblG1u4lEjw0MOP7A3rjm9AI+KhciGn2YKrF+HIoqFze5xgVwfPBkTifhBM148jzQ8HlyuzU0Tg4m28wMCH5IICVm2z0AcDh8D644pk2Y1K1IXeqxDQDom37Nq9awXCV7nZIzisPkvPcHCHcZgZgUvKfO24OdHlTiGEzLbplg4A8L4GFB8YXY1HkpjNjeV/wuyu2r7LDtQCaloKcwBeFU3D0M/p1BMRkCmANi1cfVp6e615PsmE5W6vMXNPpXC9YzPjksURs4fNuinbAdboaR7rjOesU9lBgtnOK6AfCb4P94+EnCYwMdEuOtVDUUhqNkLjWMBlHSPLhQqNjPGVfqjBOawA4DpkNM99YKLpt2Pw5e1B9c24E/FsJYcf1TZtIItVnOtf7Uqakye2aCOzFF2rYqn8ORZa7C/1VmahElBfPQqsh5te/+qOPC8Go1r/Yc7Dyy0vID0vSy1bzcPet6AJGhXl82bz5WY/D93AbHJijMXoLChKcNkUnOzNw1YG5kRn9+FvYKu1jITyMAAo/Vg5qZHvPMGjENrYiqIWAnOL4DyXPEGkGHAR65rR+2884Hs1yo3MSZ78dMyCUGVCsDCBFlMkaiFgRdm72iR2AA37kZaUji/c55vRqC86XzSpzn+vTzr3KrHcOGRjcVmqMWoXLx2+o=
branches:
  only:
  - master

install: # needed to run deployment scripts
  - cd ./$SERVICE
  - nvm install
  - nvm use
  - node --version
  - npm install --only=production
before_script:
- make ensure-dependencies
script:
- make brand
- make package
- make qa
- make archive
- make check
after_script:
- make deploy
matrix:
  include:
  - env: SERVICE=recipes-infra
  - env: SERVICE=recipes-api
    services:
    - docker
  - env: SERVICE=recipes-crawler
    services:
    - docker
  - env: SERVICE=recipes-id-generator
    services:
    - docker
notifications:
  slack:
    secure: eJtVJ7Kj2e3vjJazLAayQ7in1zgY/7/+yWd0lPckymkEQFbbgpN8AGWCNePG+9AWMjzb7icQ7tHGi8ZBxCEd6cJp6bTBgBMRZjBagMzfMwmej193Sg0GGvg2DVKjTzDY3x0btU+h0K23raAFc6UIpYqm84CiD7RhGh5GRDbXSpynhD9GWuGkZWj3eezr/ZIzfRAeV63y/2mE8e0Sx29rS367ktW/0mN65J1AlcDtsMiwlHVNX9CQh6FQBOK4o3BbmTvjpz8Gz5mpBKdq5JBhoSAI+/QRK9+Vy3oA/cpdJoMT96nxuvJIVqNOw24JxrBK+mp8V6xvk31oOOsJeQCqysiRTNImujCJ26xgsty/HDeLIA2AyCNqEqkSZhbYHpBXwjenbrperRl3twiAGpnbYBrE4lBHi1dGNYtde4c5q2fac/t9Q3fsNGua92ryRvlJhs+jU7Cvgebg3x2FjJ0fzmLOHkXDdhMETPYFVBspMhBw7gSN3CQhO10gGEoh7CqwZuL7xTLsnj9745bfbISHdiTph4fo442XG9Vs6eUJ9fp/HZ/J9jU2OB0LOmx1Ei1yCBhTR8agDAqQGXwCnTxXxhBJo0lF4t5dOV3eIvEL2pwnNbw+vCYWaV6FZrNEcIG6/2FnTTnmwvTuDmbf3njTi72Omaikn9upptciOPKEDyg=
